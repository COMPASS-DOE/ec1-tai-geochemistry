---
title: "TAI Geochemistry Analysis"
author: "AMP, KH, DD"
date: '2022-08-10'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Load in Data
```{r Load Data}
library(tidyverse)
soilparty = readRDS("./soils_data_merged.rds")
```

##Complete Data
Getting together only the samples that have a complete dataset 
```{r data}
completeset = soilparty %>%
    select(!ends_with("_flag")) %>% na.omit()

```

## Clean Data for nmds 

```{r clean for nmds }
completeset$visible_minerals <- factor(completeset$visible_minerals, levels =c("None", "Mica", "Quartz"))
completeset$visible_minerals <- as.integer(completeset$visible_minerals)

completeset$visible_iron_oxidation <- factor(completeset$visible_iron_oxidation, levels =c("No", "Yes"))
completeset$visible_iron_oxidation <- as.integer(completeset$visible_iron_oxidation)

completeset$visible_white_flakes <- factor(completeset$visible_white_flakes, levels =c("No", "Yes"))
completeset$visible_white_flakes <- as.integer(completeset$visible_white_flakes)

soils4NMDS = completeset %>% unite(uniqueid, c(campaign,kit_id,transect_location)) %>% dplyr::select(!acidification) %>%
dplyr::select(!date_run) %>%
dplyr::select(!root_mass) %>%
column_to_rownames(var="uniqueid")

```

This is a mess: 

```{r Playing}
library(vegan)

soilspca = prcomp(soils4NMDS, retx = TRUE, center = TRUE, scale. = TRUE)
biplot(soilspca)

# soils_distmat <- 
#   vegdist(soils4NMDS, method = "bray")
# 
# soils_distmat <- 
#   as.matrix(soils_distmat, labels = T)
# #write.csv(soils_distmat, "soils_distmat.csv")
# 
# Soils_NMDS <-
#   metaMDS(soils_distmat,
#           distance = "bray",
#           k = 3,
#           maxit = 999, 
#           trymax = 500,
#           wascores = TRUE)
# # Run 20 stress 0.0334468 
# # Procrustes: rmse 0.0009725123  max resid 0.002912856 
# goodness(Soils_NMDS)
# stressplot(Soils_NMDS)
# 
# #NMR_NMS_1 <-
# #  metaMDS(NMR_distmat,
# #          distance = "bray",
# #          k = 3,
# #          maxit = 999, 
#  #         trymax = 500,
#  #         wascores = TRUE)
# #Run 20 stress 0.03344632 
# # Procrustes: rmse 0.0002681262  max resid 0.001004477 
# #goodness(NMR_NMS_1)
# #stressplot(NMR_NMS_1)
```

